namespace: Cerner.DigitalFactory.Common.JIRA.Operation
operation:
  name: createJirafieldType_json
  inputs:
    - jirafieldkey
    - jirafieldkeyValue
    - json_keyValue:
        required: false
    - jirafieldkeyType
  python_action:
    use_jython: false
    script: "###############################################################\r\n#   OO operation for Proccessing the input values and convert them into JIRA API Json Body\r\n#   Operation: createJirafieldType_json\r\n#   Author: Rakesh Sharma\r\n#   Inputs:\r\n#       -  jirafieldkey\r\n#       -  jirafieldkeyValue\r\n#       -  json_keyValue\r\n#       -  jirafieldkeyType\r\n#\r\n#   Outputs:\r\n#       - result\r\n#       - message\r\n#       - json_key_value\r\n#\r\n#   Modified by Rakesh Sharma on 06 May 2021 for supporting Nested Values in jira field\r\n#   Modified on 03 Nov 2022 by Rakesh Sharma to add nameobject Key Type\r\n###############################################################\r\n\r\ndef execute(jirafieldkey, jirafieldkeyValue, json_keyValue, jirafieldkeyType):\r\n    message = \"\"\r\n    result = \"False\"\r\n    key = \"\"\r\n    keyType = \"\"\r\n    json_key_value = \"\"\r\n\r\n    try:\r\n        if json_keyValue != 'tt' and json_keyValue:\r\n            json_key_value = json_keyValue\r\n\r\n        if jirafieldkeyType == 'default' or jirafieldkeyType.lower() == 'rich':\r\n            json_key_value += '\"' + jirafieldkey + '\":\"' + jirafieldkeyValue + '\",'\r\n            result = \"True\"\r\n\r\n        elif jirafieldkeyType == 'array':\r\n            list = jirafieldkeyValue.split(',')\r\n            json_key_value += '\"' + jirafieldkey + '\": ['\r\n            for val in list:\r\n                val = val.strip()\r\n                if val:\r\n                    json_key_value += '{\"value\":\"' + val + '\"},'\r\n\r\n            json_key_value = json_key_value[:-1]\r\n            json_key_value += '],'\r\n            result = \"True\"\r\n            \r\n        elif jirafieldkeyType == 'arraystring':\r\n            list = jirafieldkeyValue.split(',')\r\n            json_key_value += '\"' + jirafieldkey + '\": ['\r\n            for val in list:\r\n                val = val.strip()\r\n                if val:\r\n                    json_key_value += '\"' + val + '\",'\r\n\r\n            json_key_value = json_key_value[:-1]\r\n            json_key_value += '],'\r\n            result = \"True\"\r\n\r\n        elif jirafieldkeyType == 'value':\r\n            list = jirafieldkeyValue.split(',')\r\n            json_key_value += '\"' + jirafieldkey + '\":'\r\n            for val in list:\r\n                val = val.strip()\r\n                if val:\r\n                    json_key_value += '{\"value\":\"' + val + '\"},'\r\n\r\n            json_key_value = json_key_value[:-1]\r\n            json_key_value += ','\r\n            result = \"True\"\r\n            \r\n        elif jirafieldkeyType == 'name':\r\n            list = jirafieldkeyValue.split(',')\r\n            json_key_value += '\"' + jirafieldkey + '\": ['\r\n            for val in list:\r\n                val = val.strip()\r\n                if val:\r\n                    json_key_value += '{\"name\":\"' + val + '\"},'\r\n\r\n            json_key_value = json_key_value[:-1]\r\n            json_key_value += '],'\r\n            result = \"True\"\r\n            \r\n        elif jirafieldkeyType == 'nameobject':\r\n            val = jirafieldkeyValue\r\n            if val:\r\n                json_key_value += '\"' + jirafieldkey + '\": '\r\n                json_key_value += '{\"name\":\"' + val + '\"},'\r\n            result = \"True\"\r\n\r\n        elif jirafieldkeyType == 'nested':\r\n            parent_val = jirafieldkeyValue.split(',')[0].strip()\r\n            child_val = jirafieldkeyValue.split(',')[1].strip()\r\n\r\n            json_key_value += '\"' + jirafieldkey + '\":'\r\n\r\n            if not child_val or child_val == 'none':\r\n                json_key_value += '{\"value\":\"' + parent_val + '\", \"child\": null},'\r\n            else:\r\n                json_key_value += '{\"value\":\"' + parent_val + '\", \"child\":{\"value\":\"' + child_val + '\"}},'\r\n\r\n            json_key_value = json_key_value[:-1]\r\n            json_key_value += ','\r\n            result = \"True\"\r\n\r\n        else:\r\n            result = 'False'\r\n            message = 'Unsupported Jira field value type format. Only array, value, name ,nested and normal value  format supported'\r\n\r\n\r\n    except Exception as e:\r\n        message = str(e)\r\n        result = \"False\"\r\n    return {\"result\": result, \"message\": message, \"json_key_value\": json_key_value}"
  outputs:
    - result
    - message
    - json_key_value
  results:
    - SUCCESS: '${result == "True"}'
      CUSTOM_0: '${result == "name"}'
    - FAILURE
