namespace: Cerner.Integrations.SMAX.Operation
operation:
  name: prepareValues_for_jiraToolRequest
  inputs:
    - jira_tool_key
    - jira_request_tool
    - project_tool_mapping
    - watchers:
        required: false
    - summary
    - description
    - fields_append_toDescription:
        required: false
    - request_common_fields:
        required: false
    - get_jira_fields_fm_smax_config:
        required: false
    - get_jira_fields_fm_oo_config:
        required: false
    - get_id_value_fm_oo_config:
        required: false
    - hide_fields_In_Jira:
        required: false
  python_action:
    use_jython: false
    script: "###############################################################\r\n#   OO operation for Generating Watchers JSON object\r\n#   Operation: prepareValues_for_jiraToolRequest\r\n#   Author: Rakesh Sharma Cerner (rakesh.sharma@cerner.com)\r\n#   Created On: 25 May 2022\r\n#   Inputs:\r\n#       - jira_tool_key\r\n#       - jira_request_tool\r\n#       - project_tool_mapping\r\n#       - watchers\r\n#       - summary\r\n#       - description\r\n#       - fields_append_toDescription\r\n#       - request_common_fields\r\n#       - get_jira_fields_fm_smax_config\r\n#       - get_jira_fields_fm_oo_config\r\n#       - get_id_value_fm_oo_config\r\n#       - hide_fields_In_Jira\r\n#\r\n#\r\n#   Outputs:\r\n#       - result\r\n#       - message\r\n#       - errorType\r\n#       - errorSeverity\r\n#       - errorProvider\r\n#       - errorMessage\r\n#       - watchers_tool\r\n#       - summary_tool\r\n#       - request_common_fields_tool\r\n#       - description_tool\r\n#       - fields_append_toDescription_tool\r\n#       - get_jira_fields_fm_smax_config_tool\r\n#       - get_jira_fields_fm_oo_config_tool\r\n#       - get_id_value_fm_oo_config_tool\r\n#       - hide_fields_In_Jira_tool\r\n#\r\n#  -------------------------------------------------------------\r\n################################################################\r\n\r\ndef execute(jira_tool_key, jira_request_tool, project_tool_mapping, watchers, summary, description,\r\n            fields_append_toDescription,\r\n            request_common_fields, get_jira_fields_fm_smax_config, get_jira_fields_fm_oo_config,\r\n            get_id_value_fm_oo_config,\r\n            hide_fields_In_Jira):\r\n    result = \"False\"\r\n    message = ''\r\n    errorType = ''\r\n    errorMessage = ''\r\n    errorSeverity = ''\r\n    errorProvider = ''\r\n\r\n    watchers_tool = ''\r\n    summary_tool = ''\r\n    description_tool = ''\r\n    request_common_fields_tool = ''\r\n    jira_direct_fields_tool = ''\r\n    get_jira_fields_fm_smax_config_tool = ''\r\n    get_jira_fields_fm_oo_config_tool = ''\r\n    get_id_value_fm_oo_config_tool = ''\r\n    hide_fields_In_Jira_tool = ''\r\n    fields_append_toDescription_tool = ''\r\n\r\n    try:\r\n        # prepare output variables for the specific tool\r\n        watchers_tool = watchers.replace('][', ',')\r\n        # request_common_fields_tool = request_common_fields\r\n        summary_tool = summary.replace('<tool_access>', jira_request_tool)\r\n        description_tool = description.replace('<tool_access>', jira_request_tool)\r\n        description_tool = description.replace('&lt;tool_access&gt;:', jira_request_tool)\r\n\r\n        # set jira_direct_fields_tool value\r\n        jira_direct_fields_tool = 'summary,' + summary_tool + '||'\r\n\r\n        ##Get the default project from project_tool_mapping\r\n        if 'default' in project_tool_mapping.lower():\r\n            for i in project_tool_mapping.split('||'):\r\n                if i:\r\n                    key = i.split(',')[0]\r\n                    value = i.split(',')[1].lower()\r\n                    if value == 'default':\r\n                        project = key\r\n                        break\r\n        else:\r\n            msg = 'Unformatted input for Parameter \"project_tool_mapping\" for Value: No Default Project Provided'\r\n            raise Exception(msg)\r\n        ## Get the Project for the requested tool:\r\n        if jira_request_tool in project_tool_mapping:\r\n            for i in project_tool_mapping.split('||'):\r\n                if i:\r\n                    key = i.split(',')[0]\r\n                    value = i.split(',', 1)[1]\r\n                    if jira_request_tool in value:\r\n                        project = key\r\n\r\n        # Preparing \"fields_append_toDescription_tool\" for requested jira tool\r\n        for i in fields_append_toDescription.split('||'):\r\n            if fields_append_toDescription and i:\r\n                if '!' in i:\r\n                    key = i.split('!')[0]\r\n                    value = i.split('!')[1]\r\n                    if key == jira_request_tool or key.lower() == 'common':\r\n                        fields_append_toDescription_tool += value + '||'\r\n                else:\r\n                    msg = 'Unformatted input for Parameter \"fields_append_toDescription_tool\" for Value (No Tool as prefix): ' + i\r\n                    raise Exception(msg)\r\n\r\n        # Preparing \"get_jira_fields_fm_smax_config\" for requested jira tool\r\n        for i in get_jira_fields_fm_smax_config.split('||'):\r\n            if get_jira_fields_fm_smax_config and i:\r\n                if '!' in i:\r\n                    key = i.split('!')[0]\r\n                    value = i.split('!')[1]\r\n                    if key == jira_request_tool:\r\n                        get_jira_fields_fm_smax_config_tool += value + '||'\r\n                else:\r\n                    msg = 'Unformatted input for Parameter \"get_jira_fields_fm_smax_config\" for Value (No Tool as prefix): ' + i\r\n                    raise Exception(msg)\r\n\r\n        # Preparing \"get_jira_fields_fm_oo_config\" for requested jira tool\r\n        for i in get_jira_fields_fm_oo_config.split('||'):\r\n            if get_jira_fields_fm_oo_config and i:\r\n                if '!' in i:\r\n                    key = i.split('!')[0]\r\n                    value = i.split('!')[1]\r\n                    if key == jira_request_tool:\r\n                        get_jira_fields_fm_oo_config_tool += value + '||'\r\n                else:\r\n                    msg = 'Unformatted input for Parameter \"get_jira_fields_fm_oo_config\" for Value (No Tool as prefix): ' + i\r\n                    raise Exception(msg)\r\n\r\n        # Preparing \"get_id_value_fm_oo_config\" for requested jira tool\r\n        # add project value to the parameter\r\n        if 'value.' in jira_tool_key:\r\n            jira_tool_key = jira_tool_key.replace('value.', '')\r\n        get_id_value_fm_oo_config_tool = 'project,' + project + '||' + jira_tool_key + ',' + jira_request_tool + '||'\r\n        for i in get_id_value_fm_oo_config.split('||'):\r\n            if get_id_value_fm_oo_config and i:\r\n                if '!' in i:\r\n                    key = i.split('!')[0]\r\n                    value = i.split('!')[1]\r\n                    if key == jira_request_tool:\r\n                        get_id_value_fm_oo_config_tool += value + '||'\r\n                else:\r\n                    msg = 'Unformatted input for Parameter \"get_id_value_fm_oo_config\" for Value (No Tool as prefix): ' + i\r\n                    raise Exception(msg)\r\n\r\n        ## check if any id type key in request_common_fields_tool\r\n        for i in request_common_fields.split('||'):\r\n            if i:\r\n                key = i.split(',')[0]\r\n                value = i.split(',')[1]\r\n                if 'id.' in key.lower() or 'issuetype' in key.lower() or 'priority' in key.lower():\r\n                    get_id_value_fm_oo_config_tool += key.replace('value.', '').replace('id.', '') + ',' + value + '||'\r\n                else:\r\n                    request_common_fields_tool += i + '||'\r\n\r\n        # Preparing \"hide_fields_In_Jira\" for requested jira tool\r\n        for i in hide_fields_In_Jira.split('||'):\r\n            if hide_fields_In_Jira and i:\r\n                if '!' in i:\r\n                    key = i.split('!')[0]\r\n                    value = i.split('!')[1]\r\n                    if key == jira_request_tool:\r\n                        hide_fields_In_Jira_tool += value + '||'\r\n                else:\r\n                    msg = 'Unformatted input for Parameter \"hide_fields_In_Jira\" for Value (No Tool as prefix): ' + i\r\n                    raise Exception(msg)\r\n        result = 'True'\r\n\r\n    except Exception as e:\r\n        message = e\r\n        result = \"False\"\r\n        errorType = \"e30000\"\r\n        errorMessage = message\r\n        errorSeverity = \"ERROR\"\r\n        errorProvider = \"OOExec\"\r\n\r\n    return {\"result\": result, \"message\": message, \"errorType\": errorType, \"errorSeverity\": errorSeverity,\r\n            \"errorProvider\": errorProvider, \"errorMessage\": errorMessage,\r\n            \"watchers_tool\": watchers_tool, \"request_common_fields_tool\": request_common_fields_tool,\r\n            \"summary_tool\": summary_tool, \"description_tool\": description_tool,\r\n            \"fields_append_toDescription_tool\": fields_append_toDescription_tool,\r\n            \"get_jira_fields_fm_smax_config_tool\": get_jira_fields_fm_smax_config_tool,\r\n            \"get_jira_fields_fm_oo_config_tool\": get_jira_fields_fm_oo_config_tool,\r\n            \"get_id_value_fm_oo_config_tool\": get_id_value_fm_oo_config_tool,\r\n            \"hide_fields_In_Jira_tool\": hide_fields_In_Jira_tool, \"jira_direct_fields_tool\": jira_direct_fields_tool\r\n            }"
  outputs:
    - result
    - message
    - errorType
    - errorSeverity
    - errorProvider
    - errorMessage
    - watchers_tool
    - summary_tool
    - description_tool
    - fields_append_toDescription_tool
    - request_common_fields_tool
    - get_jira_fields_fm_smax_config_tool
    - get_jira_fields_fm_oo_config_tool
    - get_id_value_fm_oo_config_tool
    - hide_fields_In_Jira_tool
    - jira_direct_fields_tool
  results:
    - SUCCESS: '${result=="True"}'
    - FAILURE
